## A Solana Cluster
Solana集群是一组共同工作的验证器，为客户事务提供服务，并维护分类账本的完整性。许多集群可以共存。当两个集群共享一个创世区块时，它们会试图聚合。否则，他们会忽视对方的存在。发送事务给错误的一方会被悄然拒绝。在本节中，我们将讨论如何创建集群、加入集群，它们如何共享账本，如何确保账本被复制，如何处理bug和恶意节点。

### 创建一个集群(Creating a Cluster )
在启动一个验证者之前，首先需要创建一个genesis 的配置。该配置引用了连个公钥，一个mint和一个引导验证器(bootstrap validator)。持有引导验证器(bootstrap validator)的私钥的验证者，负责将第一个条目附加到分类账中。它用mint 的帐户来初始化他的内部状态。这个帐户将持有genesis 配置中定义的原生token 数量。然后，第二个validator与引导验证器(bootstrap validator)联系，以注册为验证器。然后，其他验证器向集群的任何已注册成员注册。

validator接收所有来自领导者的条目，并提交投票以确认这些条目是有效的。投票之后，validator将存储这些条目(entries)。一旦validator发现有足够数量的副本存在，它就删除它的副本。

### 加入一个集群(Joining a Cluster)
validator通过发送到集群的 control plane 的注册消息进入集群。这个 control plane 使用 gossip 协议，这意味着节点可以注册到任何现有的节点，并期望其注册传播到集群中的所有节点。所有节点同步的时间与参与集群的节点数的平方成正比。从算法上来讲，这被认为是非常慢的， 但是换来的是，一个节点可以确保它最终拥有与其他节点相同的所有信息，并且这些信息不会被任何一个节点删除(censored)。

### 发送交易到集群 (Sending Transactions to a Cluster)
客户端发送交易到任何一个validator  的交易处理单元 (TPU)的端口。如果节点处于验证者的角色，它将交易转发给指定的leader。如果是leader 的角色，节点将传入事务捆绑在一起，为它们创建一个条目并打上时间戳，并将它们推到集群的data plane上。一旦进入data plane，事务就会由验证器节点进行验证，有效地将它们添加到分类账中。

### 确认交易(Confirming Transactions) 
Solana集群能够对多达150个节点进行亚秒级的确认，并计划扩展到数十万个节点。一旦完全实现，确认时间预计只会随着验证器数量的对数而增加，其中的对数基数非常高。例如，如果基数是1000，这意味着对于前1000个节点，确认将是三个网络跳的时间加上最慢的绝大多数(supermajority)验证者进行投票的时间。对于接下来的一百万个节点，确认只增加一个网络跳。

Solana 将 comfirmations 定义为，从Leader 将新entey打上时间戳，到确认绝大多数投票的时间。

gossip是非常缓慢的，一旦它的规模超过了一定的规模，就无法实现次秒的确认。将消息发送到所有节点所需的时间与节点数量的平方成正比。如果区块链想要实现低确认，并试图使用gossip网络来实现，它将被迫集中到少数几个节点上。

可扩展的确认可以使用以下技术组合来实现:
1. 使用VDF为交易打时间戳，并签名时间戳
2. 将事务分成批处理，将每个事务发送到单独的节点，并让每个节点与其对等节点共享它的批处理。
3. 递归地重复上一步，直到所有节点都有所有的批处理。

Solana以固定的时间间隔轮换领导者，这被称为```slots```。每个leader只能在其分配的```slot```内产生entry。因此，leader给事务添加时间戳，以便validator可以查找指定leader的公钥。然后Leader对时间戳进行签名，以便validator可以验证签名，证明签名者是指定领导的公钥的所有者。

接下来，事务被分成批处理，这样一个节点就可以将事务发送给多方，而无需复制多个副本。例如，如果leader需要向6个节点发送60个事务，那么它将把这60个事务集合分成10个事务批次，并向每个节点发送一个事务。这允许leader在线上放置60个事务，而不是为每个节点放置60个事务。然后，每个节点与它的对等节点共享它的批处理。一旦节点收集了所有6个批次，它就重新构建最初的60个事务集。

一批事务只能被分割很多次，直到它变得非常小，以致报头信息成为网络带宽的主要消费者。在写数据时，该方法可扩展到大约150个validator。为了扩展到数十万个Validator，每个节点都可以对另一组同等大小的节点应用与前导节点相同的技术。我们称之为涡轮块传播技术(Turbine Block Propogation)。
