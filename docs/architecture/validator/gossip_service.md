## Gossip 服务
Gossip 服务充当到 Contorl plane 节点的网关。Validator 使用该服务来确保信息对集群中的所有其他节点可用。该服务使用Gossip议广播信息。

### Gossip 简介
节点之间持续地共享签名数据对象，以管理集群。例如，他们分享自己的联系信息、账本高度和投票。

每十分之一秒，每个节点发送一个“push”消息和/或一个“pull”消息。Push和pull消息可能会引起响应，并且Push消息可能被转发到集群中的其他消息。

Gossip 运行在一个知名的UDP/IP端口或一个知名范围内的端口上。一旦集群被引导，节点之间就会通告到哪里可以找到它们的Gossip 端点(套接字地址)。

### Gossip 记录
通过 gossip 共享的记录是任意的，但是根据需要进行签名和版本控制(使用时间戳)，以使接收它们的节点有意义。如果一个节点从同一源接收到两条记录，它将使用具有最近时间戳的记录更新自己的副本。

### Gossip 服务接口

#### 推送消息
一个节点发送一个推送消息来告诉集群它有信息可以共享。节点向```PUSH_FANOUT```推送节点发送推送消息。

在接收到推送消息后，节点检查该消息:
    1. Duplication: 如果该消息之前被看到过，该节点丢弃该消息，如果是从一个低风险节点转发，该节点可以使用PushMessagePrune响应该消息。

    2. New data: 如果是一个消息到达节点
        - 将带有更新版本的新信息存储在其集群信息中，并清除以前的旧值
        - 将消息存储在 pushed_once 中(用于检测重复，在PUSH_MSG_TIMEOUT * 5毫秒后清除)
        - 将消息重新传输到它自己的推送对等点

    3. Expiration: 节点删除超过```PUSH_MSG_TIMEOUT```的推送消息

#### 推送节点， 删除消息
节点从已知的活跃节点集中随机选择它的推送节点。节点保持这个选择的时间相对较长。节点收到剪枝消息后，丢弃发送剪枝消息的推送节点。剪枝表示有另一条比直接推送更高的权重路径到达该节点。

通过每隔```PUSH_MSG_TIMEOUT/2```毫秒循环一个新节点到推节点集来保持推节点集的新鲜。

#### 拉取消息
节点发送pull消息，询问集群是否有新信息。拉取消息被随机发送到单个对等点，并包含一个表示它已经拥有的东西的Bloom过滤器。接收拉取消息的节点遍历它的值，并构造一个拉取响应，对象是那些没有经过筛选且适合消息的内容。

节点通过迭代当前值和最近清除的值来构造pull Bloom过滤器。

节点在pull响应中处理项的方式与在push消息中处理新数据的方式相同。

### 清除(Purging)
节点在purged_values(我最近拥有的东西)中保留值的以前版本(通过拉或推更新的)和过期的值(比```GOSSIP_PULL_CRDS_TIMEOUT_MS``` 更老的)。节点清除超过5 * ```GOSSIP_PULL_CRDS_TIMEOUT_MS```的 ```purged_values```。

### Eclipse 攻击
eclipse攻击是试图接管具有敌对端点的节点连接集。

这与我们的实现有以下关系。
    * 拉取消息从网络中选择一个随机节点。对拉取的eclipse攻击将要求攻击者以这样一种方式影响随机选择，即只选择对抗性节点进行拉取。 
    * 推送消息维护一个活跃的节点集，并为每个推送消息选择一个随机扇出。对 push 的 eclipse攻击将影响活动集选择，或随机扇出选择。

#### 基于时间和权益的权重
Weights 基于```stake weight``` 的 ```time since last picked``` 和```natural log```。

采用 ```ln``` 的股权权重允许给所有节点一个更公平的机会，在合理的时间内网络覆盖。它有助于规范化节点之间可能存在的巨大利益权重差异。通过这种方式，一个低权重的节点，与一个大权重的节点相比，将只需要等待 ln(stake) 秒的几倍就可以被选中。

对手是无法影响这些参数的。

#### 拉取消息
根据上述权重选择一个节点作为拉目标。

#### 推送消息
删除消息只能从潜在连接中删除对手。

就像拉消息一样，节点根据权重被选择到活动集中。

### 与PlumTree的不同
这里描述的主动推送协议是基于Plum Tree的。主要区别是:
    * 推送消息有一个由发送者签名的wallclock。一旦wallclock过期，该消息将被删除。跳数限制在敌对设置中很难实现。
    * 没有实现延迟推送，因为它不清楚如何防止对手伪造消息指纹。一种简单的方法是允许根据对手的输入让其进行优先拉取。

